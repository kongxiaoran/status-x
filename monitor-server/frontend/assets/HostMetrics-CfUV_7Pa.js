import{_ as B,r as p,o as U,a as j,b as z,g as s,u as k,d as o,h as a,j as N,E as T,k as i,l as P,v as H,G as w,x as A}from"./index-D1vLZ0px.js";import{i as G}from"./index-CUeaqhHS.js";import{a as q}from"./index-CIsCYzm8.js";const F={class:"host-metrics"},J={class:"time-range"},K={class:"card-header"},Q={class:"card-header"},W={class:"card-header"},X={__name:"HostMetrics",setup(Y){const E=N(),M=A(),g=E.params.host,y=p(null),b=p(null),C=p(null),x=p(null),I=p(null);let c={cpu:null,memory:null,disk:null,network:null,diskIo:null};const _=p([]),S=[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)],$=[{text:"最近30分钟",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-30*60*1e3),[e,t]}},{text:"最近1小时",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3),[e,t]}},{text:"最近6小时",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-6*3600*1e3),[e,t]}}];function L(){const t={cpu:y.value,memory:b.value,disk:C.value,network:x.value,diskIo:I.value};Object.entries(t).forEach(([e,u])=>{u&&(c[e]=G(u))})}function f(t,e,u,m="",v=!0){if(!t)return;const n={title:{text:e,left:"center"},tooltip:{trigger:"axis",formatter:function(l){const r=l[0].axisValue,d=l[0].value;return`${r}<br/>${l[0].seriesName}: ${d}${m}`}},xAxis:{type:"category",data:u.timestamps,axisLabel:{rotate:45}},yAxis:{type:"value",axisLabel:{formatter:`{value}${m}`}},series:[{name:e,type:"line",smooth:!0,data:u.values,areaStyle:v?{opacity:.3}:void 0,lineStyle:{width:2}}],grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0}};t.setOption(n)}async function R(){var t;if(!((t=_.value)!=null&&t.length)){T.warning("请选择时间范围");return}try{const[e,u]=_.value,m=new URLSearchParams({host:g,start:e.toISOString(),end:u.toISOString()}),v=await q.getHostMetrics(`${m}`),n={cpu:{timestamps:[],values:[]},memory:{timestamps:[],values:[]},disk:{timestamps:[],values:[]},network:{timestamps:[],values:[]},diskIo:{timestamps:[],values:[]}};v.forEach(l=>{const r=new Date(l._time).toLocaleString();switch(l._field){case"cpu_usage":n.cpu.timestamps.push(r),n.cpu.values.push(l._value);break;case"memory_usage":n.memory.timestamps.push(r),n.memory.values.push(l._value);break;case"disk_usage":n.disk.timestamps.push(r),n.disk.values.push(l._value);break;case"network_io":n.network.timestamps.push(r),n.network.values.push(l._value);break;case"read_write_io":n.diskIo.timestamps.push(r),n.diskIo.values.push(l._value);break}}),f(c.cpu,"CPU 使用率",n.cpu,"%"),f(c.memory,"内存使用率",n.memory,"%"),f(c.disk,"磁盘使用率",n.disk,"%"),f(c.network,"网络IO",n.network,"MB/s",!1),f(c.diskIo,"磁盘IO",n.diskIo,"MB/s",!1)}catch(e){console.error("获取指标���据失败:",e),T.error("获取指标数据时出现错误")}}function D(){Object.values(c).forEach(t=>{t==null||t.resize()})}return U(()=>{L(),window.addEventListener("resize",D);const t=new Date,e=new Date;e.setTime(e.getTime()-30*60*1e3),_.value=[e,t],R()}),j(()=>{window.removeEventListener("resize",D),Object.values(c).forEach(t=>{t==null||t.dispose()})}),(t,e)=>{const u=i("el-page-header"),m=i("el-date-picker"),v=i("el-button"),n=i("el-space"),l=i("el-icon"),r=i("el-tooltip"),d=i("el-card"),h=i("el-col"),V=i("el-row");return P(),z("div",F,[s(u,{content:`主机监控: ${k(g)}`,onBack:e[0]||(e[0]=O=>k(M).back())},null,8,["content"]),o("div",J,[s(n,{wrap:""},{default:a(()=>[s(m,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=O=>_.value=O),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",shortcuts:$,"default-time":S},null,8,["modelValue"]),s(v,{type:"primary",onClick:R},{default:a(()=>e[2]||(e[2]=[H(" 查询 ")])),_:1})]),_:1})]),s(V,{gutter:20},{default:a(()=>[s(h,{span:24},{default:a(()=>[s(d,{class:"chart-card"},{header:a(()=>[o("div",K,[e[3]||(e[3]=o("span",null,"CPU 使用率历史数据",-1)),s(r,{content:"CPU使用率超过90%将触发告警",placement:"top"},{default:a(()=>[s(l,null,{default:a(()=>[s(k(w))]),_:1})]),_:1})])]),default:a(()=>[o("div",{ref_key:"cpuChartRef",ref:y,class:"chart"},null,512)]),_:1})]),_:1}),s(h,{span:24},{default:a(()=>[s(d,{class:"chart-card"},{header:a(()=>[o("div",Q,[e[4]||(e[4]=o("span",null,"内存使用率历史数据",-1)),s(r,{content:"内存使用率超过90%将触发告警",placement:"top"},{default:a(()=>[s(l,null,{default:a(()=>[s(k(w))]),_:1})]),_:1})])]),default:a(()=>[o("div",{ref_key:"memoryChartRef",ref:b,class:"chart"},null,512)]),_:1})]),_:1}),s(h,{span:24},{default:a(()=>[s(d,{class:"chart-card"},{header:a(()=>[o("div",W,[e[5]||(e[5]=o("span",null,"磁盘使用率历史数据",-1)),s(r,{content:"磁盘使用率超过85%将触发告警",placement:"top"},{default:a(()=>[s(l,null,{default:a(()=>[s(k(w))]),_:1})]),_:1})])]),default:a(()=>[o("div",{ref_key:"diskChartRef",ref:C,class:"chart"},null,512)]),_:1})]),_:1}),s(h,{span:12},{default:a(()=>[s(d,{class:"chart-card"},{header:a(()=>e[6]||(e[6]=[o("div",{class:"card-header"},[o("span",null,"网络IO历史数据")],-1)])),default:a(()=>[o("div",{ref_key:"networkChartRef",ref:x,class:"chart"},null,512)]),_:1})]),_:1}),s(h,{span:12},{default:a(()=>[s(d,{class:"chart-card"},{header:a(()=>e[7]||(e[7]=[o("div",{class:"card-header"},[o("span",null,"磁盘IO历史数据")],-1)])),default:a(()=>[o("div",{ref_key:"diskIoChartRef",ref:I,class:"chart"},null,512)]),_:1})]),_:1})]),_:1})])}}},se=B(X,[["__scopeId","data-v-18b874d1"]]);export{se as default};
