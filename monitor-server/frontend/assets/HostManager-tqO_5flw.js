import{_ as D,r as V,c as T,o as F,b as h,g as t,h as n,E as r,k as u,l as f,d as p,v as y,e as O,y as U,t as w,u as I,C as P,D as R}from"./index-822VmTJk.js";import{a as b}from"./index-C5UJHDM0.js";const A={class:"host-manager"},S={class:"editable-cell"},j=["onClick"],G={class:"editable-cell"},J=["onClick"],Q={__name:"HostManager",setup(W){const g=V(null),i=V({ip_address:"",label:"",owner:"",alert_enabled:!0}),k=V([]),E={ip_address:[{required:!0,message:"IP地址不能为空",trigger:"blur"},{pattern:/^(\d{1,3}\.){3}\d{1,3}$/,message:"IP地址格式不正确",trigger:"blur"}],label:[{required:!0,message:"标签不能为空",trigger:"blur"}],owner:[{required:!0,message:"负责人不能为空",trigger:"blur"}]},K=T(()=>[...k.value].sort((e,l)=>{const s=e.ip_address.split(".").map(Number),c=l.ip_address.split(".").map(Number);for(let d=0;d<4;d++)if(s[d]!==c[d])return s[d]-c[d];return 0}));async function L(){g.value&&await g.value.validate(async e=>{if(e)try{const l=await b.addHost(i.value);l.success?(r.success("主机添加成功！"),m(),g.value.resetFields()):r.error(`添加失败: ${l.message}`)}catch(l){console.error("请求失败:",l),r.error("添加过程中出现错误")}})}async function M(e){try{await R.confirm(`确定要删除主机 ${e.ip_address} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=await b.deleteHost(`${e.ip_address}`);l.success?(r.success("主机删除成功！"),m()):r.error(`删除失败: ${l.message}`)}catch(l){l!=="cancel"&&(console.error("请求失败:",l),r.error("删除过程中出现错误"))}}async function N(e,l){try{const s=await b.updateHost({ip_address:e.ip_address,label:e.label,owner:e.owner,alert_enabled:l});console.log(s),s.success?(r.success("预警状态更新成功！"),m()):(r.error(`更新失败: ${s.message}`),e.alert_enabled=!l)}catch(s){console.error("请求失败:",s),r.error("更新过程中出现错误"),e.alert_enabled=!l}}async function m(){try{const e=await b.getHosts();e!=null&&(k.value=e)}catch(e){console.error("请求失败:",e),r.error("加载主机信息时出现错误")}}F(()=>{m()});function $(e,l){l==="label"?(e.editing=!0,e.tempLabel=e.label):l==="owner"&&(e.editingOwner=!0,e.tempOwner=e.owner)}async function v(e){if(!e.editing&&!e.editingOwner)return;const l={ip_address:e.ip_address,label:e.editing?e.tempLabel:e.label,owner:e.editingOwner?e.tempOwner:e.owner,alert_enabled:e.alert_enabled};try{const s=await b.updateHost(l);s.success?(r.success("更新成功！"),e.editing&&(e.label=e.tempLabel),e.editingOwner&&(e.owner=e.tempOwner),m()):r.error(`更新失败: ${s.message}`)}catch(s){console.error("请求失败:",s),r.error("更新过程中出现错误")}finally{e.editing=!1,e.editingOwner=!1}}return(e,l)=>{const s=u("el-page-header"),c=u("el-input"),d=u("el-form-item"),C=u("el-switch"),H=u("el-button"),q=u("el-form"),x=u("el-card"),_=u("el-table-column"),B=u("el-icon"),z=u("el-table");return f(),h("div",A,[t(s,{content:"主机管理"}),t(x,{class:"manager-card"},{header:n(()=>l[4]||(l[4]=[p("div",{class:"card-header"},[p("span",null,"添加新主机")],-1)])),default:n(()=>[t(q,{ref_key:"formRef",ref:g,model:i.value,rules:E,"label-width":"120px",inline:""},{default:n(()=>[t(d,{label:"主机IP地址",prop:"ip_address"},{default:n(()=>[t(c,{modelValue:i.value.ip_address,"onUpdate:modelValue":l[0]||(l[0]=a=>i.value.ip_address=a),placeholder:"输入主机IP地址"},null,8,["modelValue"])]),_:1}),t(d,{label:"标签",prop:"label"},{default:n(()=>[t(c,{modelValue:i.value.label,"onUpdate:modelValue":l[1]||(l[1]=a=>i.value.label=a),placeholder:"输入主机标签"},null,8,["modelValue"])]),_:1}),t(d,{label:"负责人",prop:"owner"},{default:n(()=>[t(c,{modelValue:i.value.owner,"onUpdate:modelValue":l[2]||(l[2]=a=>i.value.owner=a),placeholder:"输入负责人"},null,8,["modelValue"])]),_:1}),t(d,{label:"开启预警"},{default:n(()=>[t(C,{modelValue:i.value.alert_enabled,"onUpdate:modelValue":l[3]||(l[3]=a=>i.value.alert_enabled=a)},null,8,["modelValue"])]),_:1}),t(d,null,{default:n(()=>[t(H,{type:"primary",onClick:L},{default:n(()=>l[5]||(l[5]=[y("添加主机")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(x,{class:"manager-card"},{header:n(()=>l[6]||(l[6]=[p("div",{class:"card-header"},[p("span",null,"主机列表")],-1)])),default:n(()=>[t(z,{data:K.value,style:{width:"100%"},border:""},{default:n(()=>[t(_,{prop:"ip_address",label:"IP地址",width:"200"}),t(_,{label:"主机标签",width:"200"},{default:n(({row:a})=>[p("div",S,[a.editing?(f(),O(c,{key:0,modelValue:a.tempLabel,"onUpdate:modelValue":o=>a.tempLabel=o,size:"small",onBlur:o=>v(a),onKeyup:U(o=>v(a),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup"])):(f(),h("div",{key:1,onClick:o=>$(a,"label"),class:"editable-text"},[y(w(a.label)+" ",1),t(B,{class:"edit-icon"},{default:n(()=>[t(I(P))]),_:1})],8,j))])]),_:1}),t(_,{label:"负责人",width:"200"},{default:n(({row:a})=>[p("div",G,[a.editingOwner?(f(),O(c,{key:0,modelValue:a.tempOwner,"onUpdate:modelValue":o=>a.tempOwner=o,size:"small",onBlur:o=>v(a),onKeyup:U(o=>v(a),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup"])):(f(),h("div",{key:1,onClick:o=>$(a,"owner"),class:"editable-text"},[y(w(a.owner)+" ",1),t(B,{class:"edit-icon"},{default:n(()=>[t(I(P))]),_:1})],8,J))])]),_:1}),t(_,{label:"是否开启离线预警",width:"120"},{default:n(({row:a})=>[t(C,{modelValue:a.alert_enabled,"onUpdate:modelValue":o=>a.alert_enabled=o,onChange:o=>N(a,o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(_,{label:"操作",width:"120"},{default:n(({row:a})=>[t(H,{type:"danger",size:"small",onClick:o=>M(a)},{default:n(()=>l[7]||(l[7]=[y(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})])}}},Z=D(Q,[["__scopeId","data-v-963b1c12"]]);export{Z as default};
