import{_ as re,r as A,w as K,c as B,o as ne,E as ue,a as ie,b as w,d as o,u as f,e as V,f as N,g as t,h as s,F as S,i as z,j as de,k as c,l as p,m as ce,t as i,n as me,p as pe,q as _e,s as h,v as m,x as ge}from"./index-822VmTJk.js";import{u as ve}from"./metrics-oZua1-cA.js";import"./index-C5UJHDM0.js";const fe={class:"dashboard"},ye={class:"card-header"},Ce={class:"card-value"},ke={class:"card-header"},be={class:"card-value"},xe={class:"card-header"},we={class:"card-value"},Fe={class:"card-header"},Ue={class:"card-value"},Me={class:"card-header"},De={class:"usage-metrics"},Ve={class:"usage-item"},Ne={class:"usage-item"},Ee={class:"usage-item"},Ae={class:"control-panel"},Be={class:"control-item"},Se={class:"control-item"},he={class:"control-item"},He={key:0,class:"group-header"},Pe={class:"card-header"},$e={class:"host-info"},Ie={class:"metrics"},Te={class:"metric-item"},qe={class:"metric-item"},ze={class:"metric-item"},Ge={class:"metric-item"},Le={class:"metric-item"},Re={class:"metric-item"},Oe=1e3,je={__name:"Dashboard",setup(Je){const G=ge(),E=de(),_=ve(),D=A("label"),H=A(localStorage.getItem("detailMode")==="true"),y=A(""),b=A("");K(()=>E.query.ip,l=>{b.value=l||""},{immediate:!0}),K(b,l=>{G.replace({query:{...E.query,ip:l||void 0}})});const g=B(()=>{const l=_.hosts,e=l.length;if(e===0)return{totalHosts:0,totalCpuCores:0,totalMemory:0,totalDisk:0,avgCpuUsage:0,avgMemoryUsage:0,avgDiskUsage:0};const a=l.reduce((u,r)=>({cpuCores:u.cpuCores+r.cpu_cores,memory:u.memory+r.total_memory/1024/1024/1024,disk:u.disk+r.total_disk/1024/1024/1024,usedCpu:u.usedCpu+r.cpu_cores*r.cpu_usage/100,usedMemory:u.usedMemory+r.total_memory*r.memory_usage/100,usedDisk:u.usedDisk+r.total_disk*r.disk_usage/100}),{cpuCores:0,memory:0,disk:0,usedCpu:0,usedMemory:0,usedDisk:0});return console.log(a.memory),{totalHosts:e,totalCpuCores:a.cpuCores,totalMemory:a.memory.toFixed(2),totalDisk:a.disk.toFixed(2),avgCpuUsage:a.usedCpu/a.cpuCores*100,avgMemoryUsage:a.usedMemory/(a.memory*1024*1024*1024)*100,avgDiskUsage:a.usedDisk/(a.disk*1024*1024*1024)*100}}),Q=B(()=>{let l=_.hosts.map(e=>({...e,cpu_usage:Number(e.cpu_usage.toFixed(1)),memory_usage:Number(e.memory_usage.toFixed(1)),disk_usage:Number(e.disk_usage.toFixed(1)),network_io:Number(e.network_io.toFixed(2)),read_write_io:Number(e.read_write_io.toFixed(2))}));return b.value&&(l=l.filter(e=>e.ip.toLowerCase().includes(b.value.toLowerCase()))),l}),W=B(()=>{const l=_.hosts.map(e=>e.label||"未分组");return[...new Set(l)].sort()}),X=B(()=>{const l=Q.value;if(D.value==="label"){const e=Y(l);return y.value?{[y.value]:e[y.value]||[]}:Object.keys(e).sort().reduce((a,u)=>(a[u]=e[u],a),{})}else{const e=y.value?l.filter(a=>(a.label||"未分组")===y.value):l;return{所有主机:Z(e)}}});function Y(l){const e=l.reduce((a,u)=>{const r=u.label||"未分组";return a[r]||(a[r]=[]),a[r].push(u),a},{});return Object.keys(e).forEach(a=>{e[a].sort((u,r)=>u.ip.localeCompare(r.ip))}),e}function Z(l){return[...l].sort((e,a)=>{switch(D.value){case"cpu":return a.cpu_usage-e.cpu_usage;case"memory":return a.memory_usage-e.memory_usage;case"disk":return a.disk_usage-e.disk_usage;case"ip":default:return e.ip.localeCompare(a.ip)}})}function v(l){const e=l.reduce((u,r)=>({cpuUsage:u.cpuUsage+r.cpu_usage,memoryUsage:u.memoryUsage+r.memory_usage,diskUsage:u.diskUsage+r.disk_usage,cpuCores:u.cpuCores+r.cpu_cores,totalMemory:u.totalMemory+r.total_memory,totalDisk:u.totalDisk+r.total_disk}),{cpuUsage:0,memoryUsage:0,diskUsage:0,cpuCores:0,totalMemory:0,totalDisk:0}),a=l.length;return{totalCores:e.cpuCores,totalMemSize:(e.totalMemory/1024/1024/1024).toFixed(2),totalDiskSize:(e.totalDisk/1024/1024/1024).toFixed(2),avgCpu:(e.cpuUsage/a).toFixed(2),avgMemory:(e.memoryUsage/a).toFixed(2),avgDisk:(e.diskUsage/a).toFixed(2)}}function P(l){switch(l){case"disk":return[{color:"#67C23A",percentage:50},{color:"#E6A23C",percentage:70},{color:"#F56C6C",percentage:85}];case"network":return[{color:"#67C23A",percentage:50},{color:"#E6A23C",percentage:70},{color:"#F56C6C",percentage:85}];case"diskio":return[{color:"#67C23A",percentage:50},{color:"#E6A23C",percentage:70},{color:"#F56C6C",percentage:85}];case"netconn":return[{color:"#67C23A",percentage:50},{color:"#E6A23C",percentage:70},{color:"#F56C6C",percentage:85}];default:return[{color:"#67C23A",percentage:50},{color:"#E6A23C",percentage:70},{color:"#F56C6C",percentage:90}]}}function $(l){return l>=90?"danger":l>=70?"warning":"success"}function ee(l){G.push(`/host-metrics/${l}`)}let I;ne(async()=>{try{await _.fetchHosts(),E.query.ip&&(b.value=E.query.ip),I=setInterval(async()=>{await _.fetchHosts()},Oe)}catch{ue.error("加载数据失败")}}),ie(()=>{I&&clearInterval(I)});function L(l){return l>=1024?`${(l/1024).toFixed(2)} TB`:`${l} GB`}function T(l){return l>=85?"danger":l>=60?"warning":"success"}return(l,e)=>{const a=c("el-loading"),u=c("el-alert"),r=c("el-icon"),F=c("el-card"),U=c("el-col"),te=c("TrendCharts"),R=c("el-row"),x=c("el-option"),O=c("el-select"),se=c("el-input"),oe=c("el-switch"),q=c("el-space"),C=c("el-descriptions-item"),k=c("el-tag"),j=c("el-descriptions"),le=c("el-text"),M=c("el-progress");return p(),w("div",fe,[e[23]||(e[23]=o("h2",{class:"page-title"},"中台服务器监控",-1)),f(_).loading?(p(),V(a,{key:0,fullscreen:!0,text:"加载中..."})):N("",!0),f(_).error?(p(),V(u,{key:1,title:f(_).error,type:"error","show-icon":"",closable:"",onClose:e[0]||(e[0]=n=>f(_).error=null)},null,8,["title"])):N("",!0),f(_).error?N("",!0):(p(),V(R,{key:2,gutter:20,class:"overview-cards"},{default:s(()=>[t(U,{xs:24,sm:12,md:4},{default:s(()=>[t(F,{shadow:"hover"},{header:s(()=>[o("div",ye,[e[6]||(e[6]=o("span",null,"总主机数",-1)),t(r,null,{default:s(()=>[t(f(ce))]),_:1})])]),default:s(()=>[o("div",Ce,i(g.value.totalHosts),1)]),_:1})]),_:1}),t(U,{xs:24,sm:12,md:4},{default:s(()=>[t(F,{shadow:"hover"},{header:s(()=>[o("div",ke,[e[7]||(e[7]=o("span",null,"CPU总核心数",-1)),t(r,null,{default:s(()=>[t(f(me))]),_:1})])]),default:s(()=>[o("div",be,i(g.value.totalCpuCores),1)]),_:1})]),_:1}),t(U,{xs:24,sm:12,md:4},{default:s(()=>[t(F,{shadow:"hover"},{header:s(()=>[o("div",xe,[e[8]||(e[8]=o("span",null,"内存总量",-1)),t(r,null,{default:s(()=>[t(f(pe))]),_:1})])]),default:s(()=>[o("div",we,i(L(g.value.totalMemory)),1)]),_:1})]),_:1}),t(U,{xs:24,sm:12,md:4},{default:s(()=>[t(F,{shadow:"hover"},{header:s(()=>[o("div",Fe,[e[9]||(e[9]=o("span",null,"磁盘总量",-1)),t(r,null,{default:s(()=>[t(f(_e))]),_:1})])]),default:s(()=>[o("div",Ue,i(L(g.value.totalDisk)),1)]),_:1})]),_:1}),t(U,{xs:24,sm:24,md:8},{default:s(()=>[t(F,{shadow:"hover"},{header:s(()=>[o("div",Me,[e[10]||(e[10]=o("span",null,"整体资源使用率",-1)),t(r,null,{default:s(()=>[t(te)]),_:1})])]),default:s(()=>[o("div",De,[o("div",Ve,[e[11]||(e[11]=o("span",{class:"usage-label"},"CPU",-1)),o("span",{class:h(["usage-value",T(g.value.avgCpuUsage)])},i(g.value.avgCpuUsage.toFixed(1))+"% ",3)]),o("div",Ne,[e[12]||(e[12]=o("span",{class:"usage-label"},"内存",-1)),o("span",{class:h(["usage-value",T(g.value.avgMemoryUsage)])},i(g.value.avgMemoryUsage.toFixed(2))+"% ",3)]),o("div",Ee,[e[13]||(e[13]=o("span",{class:"usage-label"},"磁盘",-1)),o("span",{class:h(["usage-value",T(g.value.avgDiskUsage)])},i(g.value.avgDiskUsage.toFixed(1))+"% ",3)])])]),_:1})]),_:1})]),_:1})),o("div",Ae,[t(q,{wrap:"",size:30},{default:s(()=>[o("div",Be,[e[14]||(e[14]=o("span",null,"排序方式:",-1)),t(O,{modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=n=>D.value=n),placeholder:"排序方式",style:{"min-width":"150px"}},{default:s(()=>[t(x,{label:"按标签分组",value:"label"}),t(x,{label:"按IP排序",value:"ip"}),t(x,{label:"按CPU占用排序",value:"cpu"}),t(x,{label:"按内存占用排序",value:"memory"}),t(x,{label:"按磁盘占用排序",value:"disk"})]),_:1},8,["modelValue"])]),o("div",Se,[e[15]||(e[15]=o("span",null,"分组:",-1)),t(O,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=n=>y.value=n),placeholder:"选择分组",clearable:"",onClear:e[3]||(e[3]=n=>y.value=""),style:{"min-width":"250px"}},{default:s(()=>[t(x,{label:"全部",value:""}),(p(!0),w(S,null,z(W.value,n=>(p(),V(x,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),o("div",he,[e[16]||(e[16]=o("span",null,"IP筛选:",-1)),t(se,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=n=>b.value=n),placeholder:"输入IP进行筛选",clearable:"",style:{"min-width":"200px"}},null,8,["modelValue"])]),t(oe,{modelValue:H.value,"onUpdate:modelValue":e[5]||(e[5]=n=>H.value=n),"active-text":"详细","inactive-text":"简略"},null,8,["modelValue"])]),_:1})]),(p(!0),w(S,null,z(X.value,(n,J,ae)=>(p(),w("div",{key:J,class:h(["host-group",`group-theme-${ae%4}`])},[D.value==="label"?(p(),w("div",He,[t(j,{column:2,border:""},{default:s(()=>[t(C,{label:"标签"},{default:s(()=>[m(i(J),1)]),_:2},1024),t(C,{label:"主机数量"},{default:s(()=>[m(i(n.length),1)]),_:2},1024),t(C,{label:"资源统计"},{default:s(()=>[t(q,{wrap:""},{default:s(()=>[t(k,null,{default:s(()=>[m("核心数: "+i(v(n).totalCores),1)]),_:2},1024),t(k,{type:"success"},{default:s(()=>[m("内存: "+i(v(n).totalMemSize)+" GB",1)]),_:2},1024),t(k,{type:"warning"},{default:s(()=>[m("磁盘: "+i(v(n).totalDiskSize)+" GB",1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(C,{label:"平均使用率"},{default:s(()=>[t(q,{wrap:""},{default:s(()=>[t(k,{type:$(v(n).avgCpu)},{default:s(()=>[m(" CPU: "+i(v(n).avgCpu)+"% ",1)]),_:2},1032,["type"]),t(k,{type:$(v(n).avgMemory)},{default:s(()=>[m(" 内存: "+i(v(n).avgMemory)+"% ",1)]),_:2},1032,["type"]),t(k,{type:$(v(n).avgDisk)},{default:s(()=>[m(" 磁盘: "+i(v(n).avgDisk)+"% ",1)]),_:2},1032,["type"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])):N("",!0),t(R,{gutter:20},{default:s(()=>[(p(!0),w(S,null,z(n,d=>(p(),V(U,{key:d.ip,xs:24,sm:12,md:8,lg:6},{default:s(()=>[t(F,{class:"host-card",shadow:"hover",onClick:Ke=>ee(d.ip)},{header:s(()=>[o("div",Pe,[t(le,{class:"host-ip",truncated:""},{default:s(()=>[m(i(d.ip),1)]),_:2},1024),t(k,{size:"small"},{default:s(()=>[m(i(d.label||"未分组"),1)]),_:2},1024)])]),default:s(()=>[o("div",$e,[t(j,{column:2,border:"",size:"small"},{default:s(()=>[t(C,{label:"CPU核心"},{default:s(()=>[m(i(d.cpu_cores),1)]),_:2},1024),t(C,{label:"内存"},{default:s(()=>[m(i((d.total_memory/1024/1024/1024).toFixed(2))+" GB ",1)]),_:2},1024),t(C,{label:"磁盘"},{default:s(()=>[m(i((d.total_disk/1024/1024/1024).toFixed(2))+" GB ",1)]),_:2},1024),t(C,{label:"状态"},{default:s(()=>[t(k,{type:d.status!=="online"?"success":"danger"},{default:s(()=>[m(i(d.status!=="online"?"在线":"离线"),1)]),_:2},1032,["type"])]),_:2},1024)]),_:2},1024)]),o("div",Ie,[o("div",Te,[e[17]||(e[17]=o("span",{class:"metric-label"},"CPU使用率",-1)),t(M,{percentage:Number(d.cpu_usage.toFixed(1)),color:P("cpu")},null,8,["percentage","color"])]),o("div",qe,[e[18]||(e[18]=o("span",{class:"metric-label"},"内存使用率",-1)),t(M,{percentage:Number(d.memory_usage.toFixed(1)),color:P("memory")},null,8,["percentage","color"])]),o("div",ze,[e[19]||(e[19]=o("span",{class:"metric-label"},"磁盘使用率",-1)),t(M,{percentage:Number(d.disk_usage.toFixed(1)),color:P("disk")},null,8,["percentage","color"])]),H.value?(p(),w(S,{key:0},[o("div",Ge,[e[20]||(e[20]=o("span",{class:"metric-label"},"网络IO",-1)),t(M,{percentage:Number((d.network_io*10).toFixed(1)),format:()=>`${d.network_io.toFixed(2)} MB`,color:[{color:"#409EFF",percentage:0},{color:"#67C23A",percentage:100}]},null,8,["percentage","format"])]),o("div",Le,[e[21]||(e[21]=o("span",{class:"metric-label"},"磁盘IO",-1)),t(M,{percentage:Number(d.read_write_io.toFixed(1)),format:()=>`${d.read_write_io.toFixed(2)} MB`,color:[{color:"#409EFF",percentage:50},{color:"#67C23A",percentage:100}]},null,8,["percentage","format"])]),o("div",Re,[e[22]||(e[22]=o("span",{class:"metric-label"},"网络连接数",-1)),t(M,{percentage:Number((d.net_conn_count*.1).toFixed(1)),format:()=>d.net_conn_count.toString(),color:[{color:"#409EFF",percentage:50},{color:"#67C23A",percentage:100}]},null,8,["percentage","format"])])],64)):N("",!0)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)],2))),128))])}}},Ye=re(je,[["__scopeId","data-v-242dd84f"]]);export{Ye as default};
