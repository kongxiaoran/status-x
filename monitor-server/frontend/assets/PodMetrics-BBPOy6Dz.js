import{_ as S,r as m,c as T,o as H,a as j,b as w,g as e,d as r,h as t,k as a,l as P,u as f,A as I,B as q,v as i,F as G,i as J,e as K,t as b,m as O,x as Q}from"./index-822VmTJk.js";import{a as W}from"./index-C5UJHDM0.js";const X={class:"pod-metrics"},Y={class:"control-panel"},Z={class:"card-header"},ee={class:"pod-name"},oe={class:"pod-info"},te={class:"metrics"},ae={class:"metric-item"},le={class:"metric-label"},se={class:"metric-item"},ne={class:"metric-label"},re={__name:"PodMetrics",setup(ce){const U=Q(),y=m([]),v=m("name"),d=m(""),u=m(""),k=T(()=>{let s=y.value;return d.value&&(s=s.filter(o=>o.node_ip.includes(d.value))),u.value&&(s=s.filter(o=>{var n;return(n=o.namespace)==null?void 0:n.includes(u.value)})),[...s].sort((o,n)=>{switch(v.value){case"cpu":return n.cpu_usage-o.cpu_usage;case"memory":return n.memory_usage-o.memory_usage;default:const _=o.node_ip||"zzzzzzzzzzzzz",h=n.node_ip||"zzzzzzzzzzzzz",c=_.localeCompare(h);return c!==0?c:o.ip.localeCompare(n.ip)}})});function B(s){U.push(`/pod-details/${s}`)}async function z(){try{const s=new URLSearchParams({host_ip:d.value,namespace:u.value}),o=await W.getPodDashboard(`${s}`);y.value=o}catch(s){console.error("加载Pod数据失败:",s),ElMessage.error("加载Pod数据时出现错误")}}function F(){z()}let g;return H(()=>{z(),g=setInterval(z,2e3)}),j(()=>{g&&clearInterval(g)}),(s,o)=>{const n=a("el-page-header"),_=a("el-option"),h=a("el-select"),c=a("el-icon"),C=a("el-input"),N=a("el-button"),M=a("el-space"),$=a("el-tooltip"),V=a("el-descriptions-item"),D=a("el-descriptions"),E=a("CPU"),x=a("el-progress"),A=a("el-card"),L=a("el-col"),R=a("el-row");return P(),w("div",X,[e(n,{content:"Pod 资源监控"}),r("div",Y,[e(M,{wrap:""},{default:t(()=>[e(h,{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=l=>v.value=l),placeholder:"排序方式"},{default:t(()=>[e(_,{label:"按 Pod IP 排序",value:"name"}),e(_,{label:"按 CPU 占用排序",value:"cpu"}),e(_,{label:"按内存占用排序",value:"memory"})]),_:1},8,["modelValue"]),e(C,{modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=l=>d.value=l),placeholder:"搜索宿主机 IP",clearable:""},{prefix:t(()=>[e(c,null,{default:t(()=>[e(f(I))]),_:1})]),_:1},8,["modelValue"]),e(C,{modelValue:u.value,"onUpdate:modelValue":o[2]||(o[2]=l=>u.value=l),placeholder:"搜索命名空间",clearable:""},{prefix:t(()=>[e(c,null,{default:t(()=>[e(f(q))]),_:1})]),_:1},8,["modelValue"]),e(N,{type:"primary",onClick:F},{default:t(()=>[e(c,null,{default:t(()=>[e(f(I))]),_:1}),o[3]||(o[3]=i(" 搜索 "))]),_:1})]),_:1})]),e(R,{gutter:20},{default:t(()=>[(P(!0),w(G,null,J(k.value,l=>(P(),K(L,{key:l.hostname,xs:24,sm:12,md:8,lg:6},{default:t(()=>[e(A,{class:"pod-card",shadow:"hover",onClick:p=>B(l.hostname)},{header:t(()=>[r("div",Z,[e($,{content:l.hostname,placement:"top","show-after":500},{default:t(()=>[r("span",ee,b(l.hostname),1)]),_:2},1032,["content"])])]),default:t(()=>[r("div",oe,[e(D,{column:1,size:"small",border:""},{default:t(()=>[e(V,{label:"Pod IP"},{default:t(()=>[i(b(l.ip),1)]),_:2},1024),e(V,{label:"节点 IP"},{default:t(()=>[i(b(l.node_ip),1)]),_:2},1024)]),_:2},1024)]),r("div",te,[r("div",ae,[r("span",le,[e(c,null,{default:t(()=>[e(E)]),_:1}),o[4]||(o[4]=i(" CPU 使用率 "))]),e(x,{percentage:Number(l.cpu_usage.toFixed(1)),format:p=>`${p}微核`,color:[{color:"#409EFF",percentage:5e3},{color:"#ed0202",percentage:1e4}]},null,8,["percentage","format"])]),r("div",se,[r("span",ne,[e(c,null,{default:t(()=>[e(f(O))]),_:1}),o[5]||(o[5]=i(" 内存使用率 "))]),e(x,{percentage:Number(l.memory_usage.toFixed(1)),format:p=>`${p}MB`,color:[{color:"#409EFF",percentage:5e3},{color:"#ed0202",percentage:1e4}]},null,8,["percentage","format"])])])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])}}},_e=S(re,[["__scopeId","data-v-fa98689d"]]);export{_e as default};
