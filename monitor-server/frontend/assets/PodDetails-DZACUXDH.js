import{_ as P,r as w,o as M,a as N,b as U,g as o,u as S,d as r,h as s,j as C,E as $,k as d,l as I,v as O,x as j}from"./index-DD6MqGhN.js";import{i as y}from"./index-CUeaqhHS.js";const A={class:"pod-details"},q={class:"time-range"},F={__name:"PodDetails",setup(G){const L=C(),V=j(),b=L.params.pod,g=w(null),h=w(null),k=w(null);let l=null,i=null,u=null;const f=w([]),z=[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)],B=[{text:"最近30分钟",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-30*60*1e3),[e,a]}},{text:"最近1小时",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3),[e,a]}},{text:"最近6小时",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-6*3600*1e3),[e,a]}}];function E(){g.value&&(l=y(g.value)),h.value&&(i=y(h.value)),k.value&&(u=y(k.value))}function x(a,e,p,m=""){if(!a)return;const v={title:{text:e,left:"center"},tooltip:{trigger:"axis",formatter:function(c){const t=c[0].axisValue,n=c[0].value;return`${t}<br/>${c[0].seriesName}: ${n}${m}`}},xAxis:{type:"category",data:p.timestamps,axisLabel:{rotate:45}},yAxis:{type:"value",axisLabel:{formatter:`{value}${m}`}},series:[{name:e,type:"line",smooth:!0,data:p.values,areaStyle:{opacity:.3},lineStyle:{width:2}}],grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0}};a.setOption(v)}async function D(){var a;if(!((a=f.value)!=null&&a.length)){$.warning("请选择时间范围");return}try{const[e,p]=f.value,m=new URLSearchParams({pod:b,start:e.toISOString(),end:p.toISOString()}),c=await(await fetch(`/api/pod-metrics?${m}`)).json(),t={cpu:{timestamps:[],values:[]},memory:{timestamps:[],values:[]},network:{timestamps:[],values:[]}};c.forEach(n=>{const _=new Date(n._time).toLocaleString();switch(n._field){case"cpu_usage":t.cpu.timestamps.push(_),t.cpu.values.push(n._value);break;case"memory_usage":t.memory.timestamps.push(_),t.memory.values.push(n._value);break;case"network_usage":t.network.timestamps.push(_),t.network.values.push(n._value);break}}),x(l,"CPU 使用率",t.cpu,"微核"),x(i,"内存使用率",t.memory,"MB"),x(u,"网络使用率",t.network,"MB/s")}catch(e){console.error("获取指标数据失败:",e),$.error("获取指标数据时出现错误")}}function R(){l==null||l.resize(),i==null||i.resize(),u==null||u.resize()}return M(()=>{E(),window.addEventListener("resize",R);const a=new Date,e=new Date;e.setTime(e.getTime()-30*60*1e3),f.value=[e,a],D()}),N(()=>{window.removeEventListener("resize",R),l==null||l.dispose(),i==null||i.dispose(),u==null||u.dispose()}),(a,e)=>{const p=d("el-page-header"),m=d("el-date-picker"),v=d("el-button"),c=d("el-space"),t=d("el-card"),n=d("el-col"),_=d("el-row");return I(),U("div",A,[o(p,{content:`Pod 详情: ${S(b)}`,onBack:e[0]||(e[0]=T=>S(V).back())},null,8,["content"]),r("div",q,[o(c,{wrap:""},{default:s(()=>[o(m,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=T=>f.value=T),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",shortcuts:B,"default-time":z},null,8,["modelValue"]),o(v,{type:"primary",onClick:D},{default:s(()=>e[2]||(e[2]=[O(" 查询 ")])),_:1})]),_:1})]),o(_,{gutter:20},{default:s(()=>[o(n,{span:24},{default:s(()=>[o(t,{class:"chart-card"},{header:s(()=>e[3]||(e[3]=[r("div",{class:"card-header"},[r("span",null,"CPU 使用率历史数据")],-1)])),default:s(()=>[r("div",{ref_key:"cpuChartRef",ref:g,class:"chart"},null,512)]),_:1})]),_:1}),o(n,{span:24},{default:s(()=>[o(t,{class:"chart-card"},{header:s(()=>e[4]||(e[4]=[r("div",{class:"card-header"},[r("span",null,"内存使用率历史数据")],-1)])),default:s(()=>[r("div",{ref_key:"memoryChartRef",ref:h,class:"chart"},null,512)]),_:1})]),_:1}),o(n,{span:24},{default:s(()=>[o(t,{class:"chart-card"},{header:s(()=>e[5]||(e[5]=[r("div",{class:"card-header"},[r("span",null,"网络使用率历史数据")],-1)])),default:s(()=>[r("div",{ref_key:"networkChartRef",ref:k,class:"chart"},null,512)]),_:1})]),_:1})]),_:1})])}}},K=P(F,[["__scopeId","data-v-48b6e9e5"]]);export{K as default};
