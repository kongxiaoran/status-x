import{_ as D,r as k,c as T,o as A,b as $,g as t,h as n,E as r,k as i,l as g,d as m,v as h,e as O,y as U,t as w,u as I,C as P,D as F}from"./index-Dm3Rljzc.js";import{a as v}from"./index-BE7Xy69g.js";const R={class:"host-manager"},S={class:"editable-cell"},j=["onClick"],G={class:"editable-cell"},J=["onClick"],Q={__name:"HostManager",setup(W){const y=k(null),d=k({ip_address:"",label:"",owner:"",alert_enabled:!0}),C=k([]),E={ip_address:[{required:!0,message:"IP地址不能为空",trigger:"blur"},{pattern:/^(\d{1,3}\.){3}\d{1,3}$/,message:"IP地址格式不正确",trigger:"blur"}],label:[{required:!0,message:"标签不能为空",trigger:"blur"}],owner:[{required:!0,message:"负责人不能为空",trigger:"blur"}]},K=T(()=>[...C.value].sort((e,l)=>{const s=e.label||"",c=l.label||"";if(s!==c)return s.localeCompare(c);const p=e.ip_address.split(".").map(Number),f=l.ip_address.split(".").map(Number);for(let u=0;u<4;u++)if(p[u]!==f[u])return p[u]-f[u];return 0}));async function L(){y.value&&await y.value.validate(async e=>{if(e)try{const l=await v.addHost(d.value);l.success?(r.success("主机添加成功！"),_(),y.value.resetFields()):r.error(`添加失败: ${l.message}`)}catch(l){console.error("请求失败:",l),r.error("添加过程中出现错误")}})}async function M(e){try{await F.confirm(`确定要删除主机 ${e.ip_address} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=await v.deleteHost(`${e.ip_address}`);l.success?(r.success("主机删除成功！"),_()):r.error(`删除失败: ${l.message}`)}catch(l){l!=="cancel"&&(console.error("请求失败:",l),r.error("删除过程中出现错误"))}}async function N(e,l){try{const s=await v.updateHost({ip_address:e.ip_address,label:e.label,owner:e.owner,alert_enabled:l});console.log(s),s.success?(r.success("预警状态更新成功！"),_()):(r.error(`更新失败: ${s.message}`),e.alert_enabled=!l)}catch(s){console.error("请求失败:",s),r.error("更新过程中出现错误"),e.alert_enabled=!l}}async function _(){try{const e=await v.getHosts();e!=null&&(C.value=e)}catch(e){console.error("请求失败:",e),r.error("加载主机信息时出现错误")}}A(()=>{_()});function B(e,l){l==="label"?(e.editing=!0,e.tempLabel=e.label):l==="owner"&&(e.editingOwner=!0,e.tempOwner=e.owner)}async function V(e){if(!e.editing&&!e.editingOwner)return;const l={ip_address:e.ip_address,label:e.editing?e.tempLabel:e.label,owner:e.editingOwner?e.tempOwner:e.owner,alert_enabled:e.alert_enabled};try{const s=await v.updateHost(l);s.success?(r.success("更新成功！"),e.editing&&(e.label=e.tempLabel),e.editingOwner&&(e.owner=e.tempOwner),_()):r.error(`更新失败: ${s.message}`)}catch(s){console.error("请求失败:",s),r.error("更新过程中出现错误")}finally{e.editing=!1,e.editingOwner=!1}}return(e,l)=>{const s=i("el-page-header"),c=i("el-input"),p=i("el-form-item"),f=i("el-switch"),u=i("el-button"),q=i("el-form"),H=i("el-card"),b=i("el-table-column"),x=i("el-icon"),z=i("el-table");return g(),$("div",R,[t(s,{content:"主机管理"}),t(H,{class:"manager-card"},{header:n(()=>l[4]||(l[4]=[m("div",{class:"card-header"},[m("span",null,"添加新主机")],-1)])),default:n(()=>[t(q,{ref_key:"formRef",ref:y,model:d.value,rules:E,"label-width":"120px",inline:""},{default:n(()=>[t(p,{label:"主机IP地址",prop:"ip_address"},{default:n(()=>[t(c,{modelValue:d.value.ip_address,"onUpdate:modelValue":l[0]||(l[0]=a=>d.value.ip_address=a),placeholder:"输入主机IP地址"},null,8,["modelValue"])]),_:1}),t(p,{label:"标签",prop:"label"},{default:n(()=>[t(c,{modelValue:d.value.label,"onUpdate:modelValue":l[1]||(l[1]=a=>d.value.label=a),placeholder:"输入主机标签"},null,8,["modelValue"])]),_:1}),t(p,{label:"负责人",prop:"owner"},{default:n(()=>[t(c,{modelValue:d.value.owner,"onUpdate:modelValue":l[2]||(l[2]=a=>d.value.owner=a),placeholder:"输入负责人"},null,8,["modelValue"])]),_:1}),t(p,{label:"开启预警"},{default:n(()=>[t(f,{modelValue:d.value.alert_enabled,"onUpdate:modelValue":l[3]||(l[3]=a=>d.value.alert_enabled=a)},null,8,["modelValue"])]),_:1}),t(p,null,{default:n(()=>[t(u,{type:"primary",onClick:L},{default:n(()=>l[5]||(l[5]=[h("添加主机")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(H,{class:"manager-card"},{header:n(()=>l[6]||(l[6]=[m("div",{class:"card-header"},[m("span",null,"主机列表")],-1)])),default:n(()=>[t(z,{data:K.value,style:{width:"100%"},border:""},{default:n(()=>[t(b,{prop:"ip_address",label:"IP地址",width:"200"}),t(b,{label:"主机标签",width:"200"},{default:n(({row:a})=>[m("div",S,[a.editing?(g(),O(c,{key:0,modelValue:a.tempLabel,"onUpdate:modelValue":o=>a.tempLabel=o,size:"small",onBlur:o=>V(a),onKeyup:U(o=>V(a),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup"])):(g(),$("div",{key:1,onClick:o=>B(a,"label"),class:"editable-text"},[h(w(a.label)+" ",1),t(x,{class:"edit-icon"},{default:n(()=>[t(I(P))]),_:1})],8,j))])]),_:1}),t(b,{label:"负责人",width:"200"},{default:n(({row:a})=>[m("div",G,[a.editingOwner?(g(),O(c,{key:0,modelValue:a.tempOwner,"onUpdate:modelValue":o=>a.tempOwner=o,size:"small",onBlur:o=>V(a),onKeyup:U(o=>V(a),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup"])):(g(),$("div",{key:1,onClick:o=>B(a,"owner"),class:"editable-text"},[h(w(a.owner)+" ",1),t(x,{class:"edit-icon"},{default:n(()=>[t(I(P))]),_:1})],8,J))])]),_:1}),t(b,{label:"是否开启离线预警",width:"120"},{default:n(({row:a})=>[t(f,{modelValue:a.alert_enabled,"onUpdate:modelValue":o=>a.alert_enabled=o,onChange:o=>N(a,o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(b,{label:"操作",width:"120"},{default:n(({row:a})=>[t(u,{type:"danger",size:"small",onClick:o=>M(a)},{default:n(()=>l[7]||(l[7]=[h(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})])}}},Z=D(Q,[["__scopeId","data-v-54d22089"]]);export{Z as default};
