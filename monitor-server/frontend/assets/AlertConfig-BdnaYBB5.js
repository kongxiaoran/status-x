import{_ as q,r as _,o as R,E as d,b as A,d as b,g as r,h as o,k as u,l as P,v as g,y as B}from"./index-CHWozVXy.js";import{u as E}from"./metrics-DlPNDq2L.js";import{a as h}from"./index-C5sSAzlx.js";const M={class:"alert-config"},N={class:"dialog-footer"},K={__name:"AlertConfig",setup($){E();const n=_(null),s=_({cpu_threshold:90,cpu_duration:5,memory_threshold:90,memory_duration:5,disk_threshold:85}),w={cpu_threshold:[{required:!0,message:"请输入CPU阈值",trigger:"blur"},{type:"number",min:0,max:100,message:"阈值必须在0-100之间",trigger:"blur"}],cpu_duration:[{required:!0,message:"请输入持续时间",trigger:"blur"},{type:"number",min:0,message:"持续时间必须大于0",trigger:"blur"}],memory_threshold:[{required:!0,message:"请输入内存阈值",trigger:"blur"},{type:"number",min:0,max:100,message:"阈值必须在0-100之间",trigger:"blur"}],memory_duration:[{required:!0,message:"请输入持续时间",trigger:"blur"},{type:"number",min:0,message:"持续时间必须大于0",trigger:"blur"}],disk_threshold:[{required:!0,message:"请输入磁盘阈值",trigger:"blur"},{type:"number",min:0,max:100,message:"阈值必须在0-100之间",trigger:"blur"}]},m=_(!1),c=_(null),i=_({password:""}),V={password:[{required:!0,message:"请输入管理密码",trigger:"blur"}]};async function k(){n.value&&await n.value.validate(async l=>{l&&(m.value=!0)})}async function v(){c.value&&await c.value.validate(async l=>{if(l)if(i.value.password==="XR")try{const e=await h.updateAlertConfig(s.value);e.success?(d.success("警报配置更新成功！"),m.value=!1,i.value.password=""):d.error(`更新失败: ${e.message}`)}catch(e){console.error("请求失败:",e),d.error("更新过程中出现错误")}else d.error("管理密码错误")})}function x(){n.value&&n.value.resetFields()}return R(async()=>{try{const l=await h.getAlertConfig();l.success?s.value={cpu_threshold:l.cpu_threshold,cpu_duration:l.cpu_duration,memory_threshold:l.memory_threshold,memory_duration:l.memory_duration,disk_threshold:l.disk_threshold}:d.warning("获取配置失败: "+l.message)}catch(l){console.error("请求失败:",l),d.error("获取配置过程中出现错误")}}),(l,e)=>{const p=u("el-input-number"),a=u("el-form-item"),f=u("el-button"),y=u("el-form"),C=u("el-card"),U=u("el-input"),F=u("el-dialog");return P(),A("div",M,[e[12]||(e[12]=b("h2",{class:"page-title"},"警报配置",-1)),r(C,{class:"config-card"},{default:o(()=>[r(y,{ref_key:"formRef",ref:n,model:s.value,rules:w,"label-width":"180px","label-position":"left"},{default:o(()=>[r(a,{label:"CPU 使用率阈值 (%)",prop:"cpu_threshold"},{default:o(()=>[r(p,{modelValue:s.value.cpu_threshold,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.cpu_threshold=t),min:0,max:100,step:1,precision:0},null,8,["modelValue"])]),_:1}),r(a,{label:"CPU 占用持续时间 (分钟)",prop:"cpu_duration"},{default:o(()=>[r(p,{modelValue:s.value.cpu_duration,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.cpu_duration=t),min:0,precision:0,step:1},null,8,["modelValue"])]),_:1}),r(a,{label:"内存使用率阈值 (%)",prop:"memory_threshold"},{default:o(()=>[r(p,{modelValue:s.value.memory_threshold,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.memory_threshold=t),min:0,max:100,precision:0,step:1},null,8,["modelValue"])]),_:1}),r(a,{label:"内存占用持续时间 (分钟)",prop:"memory_duration"},{default:o(()=>[r(p,{modelValue:s.value.memory_duration,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.memory_duration=t),min:0,precision:0,step:1},null,8,["modelValue"])]),_:1}),r(a,{label:"磁盘使用率阈值 (%)",prop:"disk_threshold"},{default:o(()=>[r(p,{modelValue:s.value.disk_threshold,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.disk_threshold=t),min:0,max:100,precision:0,step:1},null,8,["modelValue"])]),_:1}),r(a,null,{default:o(()=>[r(f,{type:"primary",onClick:k},{default:o(()=>e[8]||(e[8]=[g("更新配置")])),_:1}),r(f,{onClick:x},{default:o(()=>e[9]||(e[9]=[g("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),r(F,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=t=>m.value=t),title:"管理员验证",width:"30%","close-on-click-modal":!1},{footer:o(()=>[b("span",N,[r(f,{onClick:e[6]||(e[6]=t=>m.value=!1)},{default:o(()=>e[10]||(e[10]=[g("取消")])),_:1}),r(f,{type:"primary",onClick:v},{default:o(()=>e[11]||(e[11]=[g("确认")])),_:1})])]),default:o(()=>[r(y,{ref_key:"passwordFormRef",ref:c,model:i.value,rules:V,"label-width":"100px"},{default:o(()=>[r(a,{label:"管理密码",prop:"password"},{default:o(()=>[r(U,{modelValue:i.value.password,"onUpdate:modelValue":e[5]||(e[5]=t=>i.value.password=t),type:"password",placeholder:"请输入管理密码","show-password":"",onKeyup:B(v,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},X=q(K,[["__scopeId","data-v-b72d4acc"]]);export{X as default};
