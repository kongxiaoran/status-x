import{_ as z,r as $,c as D,o as T,b as h,d as p,g as t,h as s,E as r,k as i,l as g,v as k,e as O,y as U,t as w,u as I,C as P,D as A}from"./index-HcRE1oiW.js";import{a as v}from"./index-DXhuTxIz.js";const F={class:"host-manager"},R={class:"editable-cell"},S=["onClick"],j={class:"editable-cell"},G=["onClick"],J={__name:"HostManager",setup(Q){const y=$(null),d=$({ip_address:"",label:"",owner:"",alert_enabled:!0}),C=$([]),E={ip_address:[{required:!0,message:"IP地址不能为空",trigger:"blur"},{pattern:/^(\d{1,3}\.){3}\d{1,3}$/,message:"IP地址格式不正确",trigger:"blur"}],label:[{required:!0,message:"标签不能为空",trigger:"blur"}],owner:[{required:!0,message:"负责人不能为空",trigger:"blur"}]},K=D(()=>[...C.value].sort((e,l)=>{const n=e.label||"",u=l.label||"";if(n!==u)return n.localeCompare(u);const _=e.ip_address.split(".").map(Number),f=l.ip_address.split(".").map(Number);for(let c=0;c<4;c++)if(_[c]!==f[c])return _[c]-f[c];return 0}));async function L(){y.value&&await y.value.validate(async e=>{if(e)try{const l=await v.addHost(d.value);l.success?(r.success("主机添加成功！"),m(),y.value.resetFields()):r.error(`添加失败: ${l.message}`)}catch(l){console.error("请求失败:",l),r.error("添加过程中出现错误")}})}async function M(e){try{await A.confirm(`确定要删除主机 ${e.ip_address} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=await v.deleteHost(`${e.ip_address}`);l.success?(r.success("主机删除成功！"),m()):r.error(`删除失败: ${l.message}`)}catch(l){l!=="cancel"&&(console.error("请求失败:",l),r.error("删除过程中出现错误"))}}async function N(e,l){try{const n=await v.updateHost({ip_address:e.ip_address,label:e.label,owner:e.owner,alert_enabled:l});console.log(n),n.success?(r.success("预警状态更新成功！"),m()):(r.error(`更新失败: ${n.message}`),e.alert_enabled=!l)}catch(n){console.error("请求失败:",n),r.error("更新过程中出现错误"),e.alert_enabled=!l}}async function m(){try{const e=await v.getHosts();e!=null&&(C.value=e)}catch(e){console.error("请求失败:",e),r.error("加载主机信息时出现错误")}}T(()=>{m()});function B(e,l){l==="label"?(e.editing=!0,e.tempLabel=e.label):l==="owner"&&(e.editingOwner=!0,e.tempOwner=e.owner)}async function V(e){if(!e.editing&&!e.editingOwner)return;const l={ip_address:e.ip_address,label:e.editing?e.tempLabel:e.label,owner:e.editingOwner?e.tempOwner:e.owner,alert_enabled:e.alert_enabled};try{const n=await v.updateHost(l);n.success?(r.success("更新成功！"),e.editing&&(e.label=e.tempLabel),e.editingOwner&&(e.owner=e.tempOwner),m()):r.error(`更新失败: ${n.message}`)}catch(n){console.error("请求失败:",n),r.error("更新过程中出现错误")}finally{e.editing=!1,e.editingOwner=!1}}return(e,l)=>{const n=i("el-input"),u=i("el-form-item"),_=i("el-switch"),f=i("el-button"),c=i("el-form"),H=i("el-card"),b=i("el-table-column"),x=i("el-icon"),q=i("el-table");return g(),h("div",F,[l[8]||(l[8]=p("h2",{class:"page-title"},"主机管理",-1)),t(H,{class:"manager-card"},{header:s(()=>l[4]||(l[4]=[p("div",{class:"card-header"},[p("span",null,"添加新主机")],-1)])),default:s(()=>[t(c,{ref_key:"formRef",ref:y,model:d.value,rules:E,"label-width":"120px",inline:""},{default:s(()=>[t(u,{label:"主机IP地址",prop:"ip_address"},{default:s(()=>[t(n,{modelValue:d.value.ip_address,"onUpdate:modelValue":l[0]||(l[0]=a=>d.value.ip_address=a),placeholder:"输入主机IP地址"},null,8,["modelValue"])]),_:1}),t(u,{label:"标签",prop:"label"},{default:s(()=>[t(n,{modelValue:d.value.label,"onUpdate:modelValue":l[1]||(l[1]=a=>d.value.label=a),placeholder:"输入主机标签"},null,8,["modelValue"])]),_:1}),t(u,{label:"负责人",prop:"owner"},{default:s(()=>[t(n,{modelValue:d.value.owner,"onUpdate:modelValue":l[2]||(l[2]=a=>d.value.owner=a),placeholder:"输入负责人"},null,8,["modelValue"])]),_:1}),t(u,{label:"开启预警"},{default:s(()=>[t(_,{modelValue:d.value.alert_enabled,"onUpdate:modelValue":l[3]||(l[3]=a=>d.value.alert_enabled=a)},null,8,["modelValue"])]),_:1}),t(u,null,{default:s(()=>[t(f,{type:"primary",onClick:L},{default:s(()=>l[5]||(l[5]=[k("添加主机")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(H,{class:"manager-card"},{header:s(()=>l[6]||(l[6]=[p("div",{class:"card-header"},[p("span",null,"主机列表")],-1)])),default:s(()=>[t(q,{data:K.value,style:{width:"100%"},border:""},{default:s(()=>[t(b,{prop:"ip_address",label:"IP地址",width:"200"}),t(b,{label:"主机标签",width:"500"},{default:s(({row:a})=>[p("div",R,[a.editing?(g(),O(n,{key:0,modelValue:a.tempLabel,"onUpdate:modelValue":o=>a.tempLabel=o,size:"small",onBlur:o=>V(a),onKeyup:U(o=>V(a),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup"])):(g(),h("div",{key:1,onClick:o=>B(a,"label"),class:"editable-text"},[k(w(a.label)+" ",1),t(x,{class:"edit-icon"},{default:s(()=>[t(I(P))]),_:1})],8,S))])]),_:1}),t(b,{label:"负责人",width:"300"},{default:s(({row:a})=>[p("div",j,[a.editingOwner?(g(),O(n,{key:0,modelValue:a.tempOwner,"onUpdate:modelValue":o=>a.tempOwner=o,size:"small",onBlur:o=>V(a),onKeyup:U(o=>V(a),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup"])):(g(),h("div",{key:1,onClick:o=>B(a,"owner"),class:"editable-text"},[k(w(a.owner)+" ",1),t(x,{class:"edit-icon"},{default:s(()=>[t(I(P))]),_:1})],8,G))])]),_:1}),t(b,{label:"是否开启离线预警",width:"120"},{default:s(({row:a})=>[t(_,{modelValue:a.alert_enabled,"onUpdate:modelValue":o=>a.alert_enabled=o,onChange:o=>N(a,o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(b,{label:"操作",width:"120"},{default:s(({row:a})=>[t(f,{type:"danger",size:"small",onClick:o=>M(a)},{default:s(()=>l[7]||(l[7]=[k(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})])}}},Y=z(J,[["__scopeId","data-v-0627ce1d"]]);export{Y as default};
