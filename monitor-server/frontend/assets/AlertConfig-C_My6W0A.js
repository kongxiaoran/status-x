import{_ as q,r as _,o as R,E as n,b as A,g as o,h as r,k as a,l as P,v as c,d as B,y as E}from"./index-C9IZr1xa.js";import{u as M}from"./metrics-CiflbIj0.js";import{a as h}from"./index-Ap6gdJGP.js";const N={class:"alert-config"},K={class:"dialog-footer"},$={__name:"AlertConfig",setup(I){M();const d=_(null),s=_({cpu_threshold:90,cpu_duration:5,memory_threshold:90,memory_duration:5,disk_threshold:85}),b={cpu_threshold:[{required:!0,message:"请输入CPU阈值",trigger:"blur"},{type:"number",min:0,max:100,message:"阈值必须在0-100之间",trigger:"blur"}],cpu_duration:[{required:!0,message:"请输入持续时间",trigger:"blur"},{type:"number",min:0,message:"持续时间必须大于0",trigger:"blur"}],memory_threshold:[{required:!0,message:"请输入内存阈值",trigger:"blur"},{type:"number",min:0,max:100,message:"阈值必须在0-100之间",trigger:"blur"}],memory_duration:[{required:!0,message:"请输入持续时间",trigger:"blur"},{type:"number",min:0,message:"持续时间必须大于0",trigger:"blur"}],disk_threshold:[{required:!0,message:"请输入磁盘阈值",trigger:"blur"},{type:"number",min:0,max:100,message:"阈值必须在0-100之间",trigger:"blur"}]},m=_(!1),g=_(null),i=_({password:""}),w={password:[{required:!0,message:"请输入管理密码",trigger:"blur"}]};async function V(){d.value&&await d.value.validate(async l=>{l&&(m.value=!0)})}async function v(){g.value&&await g.value.validate(async l=>{if(l)if(i.value.password==="XR")try{const e=await h.updateAlertConfig(s.value);e.success?(n.success("警报配置更新成功！"),m.value=!1,i.value.password=""):n.error(`更新失败: ${e.message}`)}catch(e){console.error("请求失败:",e),n.error("更新过程中出现错误")}else n.error("管理密码错误")})}function k(){d.value&&d.value.resetFields()}return R(async()=>{try{const l=await h.getAlertConfig();l.success?s.value={cpu_threshold:l.cpu_threshold,cpu_duration:l.cpu_duration,memory_threshold:l.memory_threshold,memory_duration:l.memory_duration,disk_threshold:l.disk_threshold}:n.warning("获取配置失败: "+l.message)}catch(l){console.error("请求失败:",l),n.error("获取配置过程中出现错误")}}),(l,e)=>{const x=a("el-page-header"),p=a("el-input-number"),u=a("el-form-item"),f=a("el-button"),y=a("el-form"),C=a("el-card"),U=a("el-input"),F=a("el-dialog");return P(),A("div",N,[o(x,{content:"警报配置"}),o(C,{class:"config-card"},{default:r(()=>[o(y,{ref_key:"formRef",ref:d,model:s.value,rules:b,"label-width":"180px","label-position":"left"},{default:r(()=>[o(u,{label:"CPU 使用率阈值 (%)",prop:"cpu_threshold"},{default:r(()=>[o(p,{modelValue:s.value.cpu_threshold,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.cpu_threshold=t),min:0,max:100,step:1,precision:0},null,8,["modelValue"])]),_:1}),o(u,{label:"CPU 占用持续时间 (分钟)",prop:"cpu_duration"},{default:r(()=>[o(p,{modelValue:s.value.cpu_duration,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.cpu_duration=t),min:0,precision:0,step:1},null,8,["modelValue"])]),_:1}),o(u,{label:"内存使用率阈值 (%)",prop:"memory_threshold"},{default:r(()=>[o(p,{modelValue:s.value.memory_threshold,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.memory_threshold=t),min:0,max:100,precision:0,step:1},null,8,["modelValue"])]),_:1}),o(u,{label:"内存占用持续时间 (分钟)",prop:"memory_duration"},{default:r(()=>[o(p,{modelValue:s.value.memory_duration,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.memory_duration=t),min:0,precision:0,step:1},null,8,["modelValue"])]),_:1}),o(u,{label:"磁盘使用率阈值 (%)",prop:"disk_threshold"},{default:r(()=>[o(p,{modelValue:s.value.disk_threshold,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.disk_threshold=t),min:0,max:100,precision:0,step:1},null,8,["modelValue"])]),_:1}),o(u,null,{default:r(()=>[o(f,{type:"primary",onClick:V},{default:r(()=>e[8]||(e[8]=[c("更新配置")])),_:1}),o(f,{onClick:k},{default:r(()=>e[9]||(e[9]=[c("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(F,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=t=>m.value=t),title:"管理员验证",width:"30%","close-on-click-modal":!1},{footer:r(()=>[B("span",K,[o(f,{onClick:e[6]||(e[6]=t=>m.value=!1)},{default:r(()=>e[10]||(e[10]=[c("取消")])),_:1}),o(f,{type:"primary",onClick:v},{default:r(()=>e[11]||(e[11]=[c("确认")])),_:1})])]),default:r(()=>[o(y,{ref_key:"passwordFormRef",ref:g,model:i.value,rules:w,"label-width":"100px"},{default:r(()=>[o(u,{label:"管理密码",prop:"password"},{default:r(()=>[o(U,{modelValue:i.value.password,"onUpdate:modelValue":e[5]||(e[5]=t=>i.value.password=t),type:"password",placeholder:"请输入管理密码","show-password":"",onKeyup:E(v,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},j=q($,[["__scopeId","data-v-ced26875"]]);export{j as default};
